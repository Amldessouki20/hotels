# ุฏููู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช
# User Management and Permissions Guide

## ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู
### System Overview

ูุนุชูุฏ ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงุฏู ุนูู ูุธุงู ุตูุงุญูุงุช ูุชูุฏู ูุชููู ูู:
- **ูุฌููุนุงุช ุงููุณุชุฎุฏููู (User Groups)**: ุชุตูููุงุช ุฃุณุงุณูุฉ ูููุณุชุฎุฏููู
- **ุงูุตูุงุญูุงุช (Permissions)**: ุฃุฐููุงุช ูุญุฏุฏุฉ ููู ุนูููุฉ ูู ุงููุธุงู
- **ุตูุงุญูุงุช ุงููุฌููุนุงุช (Group Permissions)**: ุฑุจุท ุงูุตูุงุญูุงุช ุจุงููุฌููุนุงุช
- **ุตูุงุญูุงุช ุงููุณุชุฎุฏููู (User Permissions)**: ุตูุงุญูุงุช ุฅุถุงููุฉ ุฎุงุตุฉ ุจูุณุชุฎุฏู ูุนูู

---

## 1. ูุฌููุนุงุช ุงููุณุชุฎุฏููู ุงูุงูุชุฑุงุถูุฉ
### Default User Groups

### ๐ด ูุฏูุฑู ุงููุธุงู (System Administrators)
**ุงููุณุคูููุงุช:**
- ุฅุฏุงุฑุฉ ูุงูู ุงููุธุงู
- ุฅุถุงูุฉ ูุญุฐู ุงููุณุชุฎุฏููู
- ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช
- ุฅุนุฏุงุฏ ุงููุธุงู ูุงูุชููููุงุช
- ูุฑุงูุจุฉ ุงูุฃุฏุงุก ูุงูุชูุงุฑูุฑ ุงูุดุงููุฉ

**ุงูุตูุงุญูุงุช ุงููุงููุฉ:**
- ุฌููุน ุนูููุงุช ุงููุธุงู (CRUD)
- ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงููุฌููุนุงุช
- ุงููุตูู ูุฌููุน ุงูุชูุงุฑูุฑ
- ุฅุนุฏุงุฏุงุช ุงููุธุงู

---

### ๐ ูุฏูุฑู ุงูููุงุฏู (Hotel Managers)
**ุงููุณุคูููุงุช:**
- ุฅุฏุงุฑุฉ ููุฏู ูุงุญุฏ ุฃู ุฃูุซุฑ
- ุฅุฏุงุฑุฉ ุงูุบุฑู ูุงูุฃุณุนุงุฑ
- ูุฑุงุฌุนุฉ ุงูุญุฌูุฒุงุช ูุงูุชูุงุฑูุฑ
- ุฅุฏุงุฑุฉ ูุฑูู ุงูุนูู ูู ุงูููุฏู

**ุงูุตูุงุญูุงุช:**
- ุฅูุดุงุก ูุชุนุฏูู ุจูุงูุงุช ุงูููุฏู ุงููุฎุตุต ูู
- ุฅุฏุงุฑุฉ ุงูุบุฑู (ุฅุถุงูุฉุ ุชุนุฏููุ ุนุฑุถ)
- ุนุฑุถ ูุชุนุฏูู ุงูุญุฌูุฒุงุช
- ุฅุฏุงุฑุฉ ุงููุฒูุงุก
- ุนุฑุถ ุชูุงุฑูุฑ ุงูููุฏู
- ุฅุฏุงุฑุฉ ุงููุฏููุนุงุช

---

### ๐ก ููุธูู ุงูุงุณุชูุจุงู (Receptionists)
**ุงููุณุคูููุงุช:**
- ุฅุฏุงุฑุฉ ุงูุญุฌูุฒุงุช ุงูููููุฉ
- ุชุณุฌูู ูุตูู ููุบุงุฏุฑุฉ ุงููุฒูุงุก
- ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงููุฒูุงุก
- ุงูุชุนุงูู ูุน ุงูุงุณุชูุณุงุฑุงุช

**ุงูุตูุงุญูุงุช:**
- ุฅูุดุงุก ูุชุนุฏูู ุงูุญุฌูุฒุงุช
- ุฅุฏุงุฑุฉ ุงููุฒูุงุก (ุฅุถุงูุฉุ ุชุนุฏููุ ุนุฑุถ)
- ุนุฑุถ ุจูุงูุงุช ุงูุบุฑู
- ุชุณุฌูู ุงููุฏููุนุงุช ุงูุฃุณุงุณูุฉ
- ุนุฑุถ ุงูุชูุงุฑูุฑ ุงูุฃุณุงุณูุฉ

---

### ๐ข ุงููุญุงุณุจูู (Accountants)
**ุงููุณุคูููุงุช:**
- ุฅุฏุงุฑุฉ ุงููุฏููุนุงุช ูุงูููุงุชูุฑ
- ูุฑุงุฌุนุฉ ุงูุชูุงุฑูุฑ ุงููุงููุฉ
- ูุชุงุจุนุฉ ุงููุณุชุญูุงุช
- ุฅุฏุงุฑุฉ ุงูุญุณุงุจุงุช ุงููุงููุฉ

**ุงูุตูุงุญูุงุช:**
- ุฅุฏุงุฑุฉ ูุงููุฉ ูููุฏููุนุงุช
- ุนุฑุถ ุฌููุน ุงูุชูุงุฑูุฑ ุงููุงููุฉ
- ุนุฑุถ ุงูุญุฌูุฒุงุช ูุงููุฒูุงุก
- ุฅุฏุงุฑุฉ ุงููุงุฆูุฉ ุงูุณูุฏุงุก ูููุฒูุงุก

---

### ๐ต ุงููุดุงูุฏูู (Viewers)
**ุงููุณุคูููุงุช:**
- ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช ููุท
- ุฅุนุฏุงุฏ ุงูุชูุงุฑูุฑ
- ุงููุฑุงูุจุฉ ูุงููุชุงุจุนุฉ

**ุงูุตูุงุญูุงุช:**
- ุนุฑุถ ุงูุจูุงูุงุช ููุท (ุจุฏูู ุชุนุฏูู)
- ุนุฑุถ ุงูุชูุงุฑูุฑ ุงูุฃุณุงุณูุฉ

---

## 2. ููููุฉ ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ
### How to Add New User

### ุฎุทูุงุช ุฅุถุงูุฉ ูุณุชุฎุฏู ูู ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ:

#### ุงูุฎุทูุฉ 1: ุงููุตูู ูุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
```
ููุญุฉ ุงูุชุญูู โ ุฅุฏุงุฑุฉ ุงููุธุงู โ ุงููุณุชุฎุฏููู โ ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ
Dashboard โ System Management โ Users โ Add New User
```

#### ุงูุฎุทูุฉ 2: ููุก ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
```typescript
// ูููุฐุฌ ุฅุถุงูุฉ ูุณุชุฎุฏู
interface NewUserForm {
  fullName: string;        // ุงูุงุณู ุงููุงูู
  email: string;           // ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ูุฑูุฏ)
  phone: string;           // ุฑูู ุงููุงุชู
  groupId: string;         // ูุฌููุนุฉ ุงููุณุชุฎุฏู
  temporaryPassword: string; // ูููุฉ ูุฑูุฑ ูุคูุชุฉ
  mustChangePassword: boolean; // ุฅุฌุจุงุฑ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
  isActive: boolean;       // ุญุงูุฉ ุงููุดุงุท
}
```

#### ุงูุฎุทูุฉ 3: ุงุฎุชูุงุฑ ูุฌููุนุฉ ุงููุณุชุฎุฏู
- **ูุฏูุฑ ูุธุงู**: ูููุฏูุฑูู ุงูุนุงููู
- **ูุฏูุฑ ููุฏู**: ููุฏูุฑู ุงูููุงุฏู
- **ููุธู ุงุณุชูุจุงู**: ูููุธูู ุงูุงุณุชูุจุงู
- **ูุญุงุณุจ**: ูููุญุงุณุจูู
- **ูุดุงูุฏ**: ูููุฑุงุฌุนูู

#### ุงูุฎุทูุฉ 4: ุชุฎุตูุต ุงูุตูุงุญูุงุช ุงูุฅุถุงููุฉ (ุงุฎุชูุงุฑู)
ูููู ุฅุถุงูุฉ ุตูุงุญูุงุช ุฎุงุตุฉ ูููุณุชุฎุฏู ุจุงูุฅุถุงูุฉ ูุตูุงุญูุงุช ูุฌููุนุชู:

```typescript
// ูุซุงู: ุฅุนุทุงุก ูุฏูุฑ ููุฏู ุตูุงุญูุฉ ุญุฐู ุงูุญุฌูุฒุงุช
const additionalPermissions = [
  'booking:delete',    // ุญุฐู ุงูุญุฌูุฒุงุช
  'guest:manage_vip',  // ุฅุฏุงุฑุฉ ูุฒูุงุก VIP
  'payment:refund'     // ุงุณุชุฑุฏุงุฏ ุงููุฏููุนุงุช
];
```

---

## 3. ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช
### Permission Management

### ุฃููุงุน ุงูุตูุงุญูุงุช ูู ุงููุธุงู:

#### ุตูุงุญูุงุช ุงููุธุงู (System Permissions)
```typescript
const systemPermissions = [
  'system:manage_users',      // ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
  'system:manage_groups',     // ุฅุฏุงุฑุฉ ุงููุฌููุนุงุช
  'system:manage_permissions', // ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช
  'system:view_audit_logs',   // ุนุฑุถ ุณุฌูุงุช ุงูุชุฏููู
  'system:manage_settings'    // ุฅุฏุงุฑุฉ ุฅุนุฏุงุฏุงุช ุงููุธุงู
];
```

#### ุตูุงุญูุงุช ุงูููุงุฏู (Hotel Permissions)
```typescript
const hotelPermissions = [
  'hotel:create',    // ุฅูุดุงุก ููุฏู
  'hotel:read',      // ุนุฑุถ ุงูููุงุฏู
  'hotel:update',    // ุชุนุฏูู ุงูููุฏู
  'hotel:delete',    // ุญุฐู ุงูููุฏู
  'hotel:manage'     // ุฅุฏุงุฑุฉ ูุงููุฉ
];
```

#### ุตูุงุญูุงุช ุงูุบุฑู (Room Permissions)
```typescript
const roomPermissions = [
  'room:create',     // ุฅูุดุงุก ุบุฑูุฉ
  'room:read',       // ุนุฑุถ ุงูุบุฑู
  'room:update',     // ุชุนุฏูู ุงูุบุฑูุฉ
  'room:delete',     // ุญุฐู ุงูุบุฑูุฉ
  'room:manage_pricing' // ุฅุฏุงุฑุฉ ุงูุฃุณุนุงุฑ
];
```

#### ุตูุงุญูุงุช ุงูุญุฌูุฒุงุช (Booking Permissions)
```typescript
const bookingPermissions = [
  'booking:create',    // ุฅูุดุงุก ุญุฌุฒ
  'booking:read',      // ุนุฑุถ ุงูุญุฌูุฒุงุช
  'booking:update',    // ุชุนุฏูู ุงูุญุฌุฒ
  'booking:delete',    // ุญุฐู ุงูุญุฌุฒ
  'booking:checkin',   // ุชุณุฌูู ุงููุตูู
  'booking:checkout'   // ุชุณุฌูู ุงููุบุงุฏุฑุฉ
];
```

#### ุตูุงุญูุงุช ุงููุฒูุงุก (Guest Permissions)
```typescript
const guestPermissions = [
  'guest:create',        // ุฅูุดุงุก ูุฒูู
  'guest:read',          // ุนุฑุถ ุงููุฒูุงุก
  'guest:update',        // ุชุนุฏูู ุงููุฒูู
  'guest:delete',        // ุญุฐู ุงููุฒูู
  'guest:manage_vip',    // ุฅุฏุงุฑุฉ VIP
  'guest:manage_blacklist' // ุฅุฏุงุฑุฉ ุงููุงุฆูุฉ ุงูุณูุฏุงุก
];
```

#### ุตูุงุญูุงุช ุงููุฏููุนุงุช (Payment Permissions)
```typescript
const paymentPermissions = [
  'payment:create',    // ุฅูุดุงุก ุฏูุนุฉ
  'payment:read',      // ุนุฑุถ ุงููุฏููุนุงุช
  'payment:update',    // ุชุนุฏูู ุงูุฏูุนุฉ
  'payment:delete',    // ุญุฐู ุงูุฏูุนุฉ
  'payment:refund',    // ุงุณุชุฑุฏุงุฏ
  'payment:approve'    // ููุงููุฉ ุนูู ุงูุฏูุน
];
```

#### ุตูุงุญูุงุช ุงูุชูุงุฑูุฑ (Report Permissions)
```typescript
const reportPermissions = [
  'report:view_basic',     // ุนุฑุถ ุงูุชูุงุฑูุฑ ุงูุฃุณุงุณูุฉ
  'report:view_financial', // ุนุฑุถ ุงูุชูุงุฑูุฑ ุงููุงููุฉ
  'report:view_detailed',  // ุนุฑุถ ุงูุชูุงุฑูุฑ ุงูููุตูุฉ
  'report:export',         // ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ
  'report:create_custom'   // ุฅูุดุงุก ุชูุงุฑูุฑ ูุฎุตุตุฉ
];
```

---

## 4. ุณููุงุฑูููุงุช ุนูููุฉ ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
### Practical User Management Scenarios

### ุงูุณููุงุฑูู 1: ุฅุถุงูุฉ ูุฏูุฑ ููุฏู ุฌุฏูุฏ
```typescript
// 1. ุฅูุดุงุก ุงููุณุชุฎุฏู
const newHotelManager = {
  fullName: "ุฃุญูุฏ ูุญูุฏ ุงูุณุนูุฏ",
  email: "ahmed.manager@hotel.com",
  phone: "+966501234567",
  groupId: "hotel-manager-001", // ูุฌููุนุฉ ูุฏูุฑู ุงูููุงุฏู
  temporaryPassword: "TempPass123!",
  mustChangePassword: true,
  isActive: true
};

// 2. ุฑุจุท ุงููุฏูุฑ ุจููุฏู ูุนูู
const hotelAssignment = {
  hotelId: "hotel-001",
  userId: newHotelManager.id,
  isActive: true
};

// 3. ุฅุถุงูุฉ ุตูุงุญูุงุช ุฎุงุตุฉ (ุงุฎุชูุงุฑู)
const additionalPermissions = [
  "booking:delete",     // ุญุฐู ุงูุญุฌูุฒุงุช
  "guest:manage_vip"    // ุฅุฏุงุฑุฉ ูุฒูุงุก VIP
];
```

### ุงูุณููุงุฑูู 2: ุฅุถุงูุฉ ููุธู ุงุณุชูุจุงู
```typescript
const newReceptionist = {
  fullName: "ูุงุทูุฉ ุฃุญูุฏ ุงูุฒูุฑุงูู",
  email: "fatima.reception@hotel.com",
  phone: "+966502345678",
  groupId: "receptionist-001", // ูุฌููุนุฉ ููุธูู ุงูุงุณุชูุจุงู
  temporaryPassword: "Reception123!",
  mustChangePassword: true,
  isActive: true
};

// ููุธูู ุงูุงุณุชูุจุงู ูุญุตููู ุนูู ุตูุงุญูุงุช ูุฌููุนุชูู ููุท
// ูุง ุญุงุฌุฉ ูุตูุงุญูุงุช ุฅุถุงููุฉ ุนุงุฏุฉ
```

### ุงูุณููุงุฑูู 3: ุฅุถุงูุฉ ูุญุงุณุจ ูุน ุตูุงุญูุงุช ุฎุงุตุฉ
```typescript
const newAccountant = {
  fullName: "ุนุจุฏุงููู ุณุงูู ุงููุทูุฑู",
  email: "abdullah.accounting@hotel.com",
  phone: "+966503456789",
  groupId: "accountant-001", // ูุฌููุนุฉ ุงููุญุงุณุจูู
  temporaryPassword: "Account123!",
  mustChangePassword: true,
  isActive: true
};

// ุตูุงุญูุงุช ุฅุถุงููุฉ ูููุญุงุณุจ ุงูุฑุฆูุณู
const additionalPermissions = [
  "guest:manage_blacklist", // ุฅุฏุงุฑุฉ ุงููุงุฆูุฉ ุงูุณูุฏุงุก
  "payment:refund",         // ุงุณุชุฑุฏุงุฏ ุงููุฏููุนุงุช
  "report:export"           // ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ
];
```

---

## 5. ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
### User Management Interface

### ุตูุญุฉ ูุงุฆูุฉ ุงููุณุชุฎุฏููู
```typescript
// ููููุงุช ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ
interface UserListPage {
  searchFilters: {
    name: string;
    email: string;
    group: string;
    isActive: boolean;
  };
  
  userActions: {
    view: (userId: string) => void;
    edit: (userId: string) => void;
    deactivate: (userId: string) => void;
    resetPassword: (userId: string) => void;
    managePermissions: (userId: string) => void;
  };
  
  bulkActions: {
    activateSelected: (userIds: string[]) => void;
    deactivateSelected: (userIds: string[]) => void;
    exportSelected: (userIds: string[]) => void;
  };
}
```

### ูููุฐุฌ ุชุนุฏูู ุงููุณุชุฎุฏู
```typescript
interface EditUserForm {
  basicInfo: {
    fullName: string;
    email: string;
    phone: string;
    isActive: boolean;
  };
  
  groupAndPermissions: {
    groupId: string;
    additionalPermissions: string[];
    removedPermissions: string[];
  };
  
  securitySettings: {
    mustChangePassword: boolean;
    accountLocked: boolean;
    sessionTimeout: number;
  };
}
```

### ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช
```typescript
interface PermissionManagementPage {
  userPermissions: {
    inherited: Permission[];    // ูู ุงููุฌููุนุฉ
    additional: Permission[];   // ุฅุถุงููุฉ
    removed: Permission[];      // ูุญุฐููุฉ
  };
  
  permissionCategories: {
    system: Permission[];
    hotel: Permission[];
    room: Permission[];
    booking: Permission[];
    guest: Permission[];
    payment: Permission[];
    report: Permission[];
  };
}
```

---

## 6. ุฃูุซูุฉ ุนูู ููุฏ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
### User Management Code Examples

### API ูุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ
```typescript
// /api/admin/users/create
export async function POST(request: Request) {
  try {
    const userData = await request.json();
    
    // 1. ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
    const currentUser = await getCurrentUser();
    if (!hasPermission(currentUser, 'system:manage_users')) {
      return NextResponse.json(
        { error: 'ุบูุฑ ูุตุฑุญ ูู ุจุฅุถุงูุฉ ูุณุชุฎุฏููู' },
        { status: 403 }
      );
    }
    
    // 2. ุงูุชุญูู ูู ุงูุจูุงูุงุช
    const validation = validateUserData(userData);
    if (!validation.isValid) {
      return NextResponse.json(
        { error: validation.errors },
        { status: 400 }
      );
    }
    
    // 3. ุงูุชุญูู ูู ุนุฏู ุชูุฑุงุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
    const existingUser = await prisma.user.findUnique({
      where: { email: userData.email }
    });
    
    if (existingUser) {
      return NextResponse.json(
        { error: 'ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุณุชุฎุฏู ุจุงููุนู' },
        { status: 409 }
      );
    }
    
    // 4. ุชุดููุฑ ูููุฉ ุงููุฑูุฑ
    const hashedPassword = await bcrypt.hash(userData.temporaryPassword, 10);
    
    // 5. ุฅูุดุงุก ุงููุณุชุฎุฏู
    const newUser = await prisma.user.create({
      data: {
        fullName: userData.fullName,
        email: userData.email,
        phone: userData.phone,
        hashedPassword,
        groupId: userData.groupId,
        mustChangePassword: true,
        isActive: userData.isActive,
        createdById: currentUser.id
      }
    });
    
    // 6. ุฅุถุงูุฉ ุงูุตูุงุญูุงุช ุงูุฅุถุงููุฉ
    if (userData.additionalPermissions?.length > 0) {
      await addUserPermissions(newUser.id, userData.additionalPermissions);
    }
    
    // 7. ุชุณุฌูู ูู ุณุฌู ุงูุชุฏููู
    await logAuditAction({
      tableName: 'User',
      recordId: newUser.id,
      action: 'CREATE',
      userId: currentUser.id,
      details: `ุชู ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ: ${newUser.fullName}`
    });
    
    // 8. ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู ุจูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ
    await sendWelcomeEmail(newUser.email, userData.temporaryPassword);
    
    return NextResponse.json({
      success: true,
      user: {
        id: newUser.id,
        fullName: newUser.fullName,
        email: newUser.email,
        groupId: newUser.groupId
      }
    });
    
  } catch (error) {
    console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุงููุณุชุฎุฏู:', error);
    return NextResponse.json(
      { error: 'ุญุฏุซ ุฎุทุฃ ูู ุฅูุดุงุก ุงููุณุชุฎุฏู' },
      { status: 500 }
    );
  }
}
```

### ุฏุงูุฉ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
```typescript
// utils/permissions.ts
export async function hasPermission(
  user: User,
  requiredPermission: string
): Promise<boolean> {
  try {
    // 1. ุงูุญุตูู ุนูู ุตูุงุญูุงุช ุงููุฌููุนุฉ
    const groupPermissions = await prisma.groupPermission.findMany({
      where: { groupId: user.groupId },
      include: { permission: true }
    });
    
    // 2. ุงูุญุตูู ุนูู ุงูุตูุงุญูุงุช ุงูุฅุถุงููุฉ ูููุณุชุฎุฏู
    const userPermissions = await prisma.userPermission.findMany({
      where: { userId: user.id },
      include: { permission: true }
    });
    
    // 3. ุฏูุฌ ุฌููุน ุงูุตูุงุญูุงุช
    const allPermissions = [
      ...groupPermissions.map(gp => gp.permission),
      ...userPermissions.map(up => up.permission)
    ];
    
    // 4. ุงูุจุญุซ ุนู ุงูุตูุงุญูุฉ ุงููุทููุจุฉ
    return allPermissions.some(permission => {
      const permissionKey = `${permission.module}:${permission.action}`;
      return permissionKey === requiredPermission;
    });
    
  } catch (error) {
    console.error('ุฎุทุฃ ูู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:', error);
    return false;
  }
}
```

### ูููู ูุงุฌูุฉ ุฅุถุงูุฉ ูุณุชุฎุฏู
```typescript
// components/admin/AddUserForm.tsx
export default function AddUserForm() {
  const [formData, setFormData] = useState<NewUserForm>({
    fullName: '',
    email: '',
    phone: '',
    groupId: '',
    temporaryPassword: '',
    mustChangePassword: true,
    isActive: true
  });
  
  const [userGroups, setUserGroups] = useState<UserGroup[]>([]);
  const [availablePermissions, setAvailablePermissions] = useState<Permission[]>([]);
  const [selectedPermissions, setSelectedPermissions] = useState<string[]>([]);
  
  useEffect(() => {
    loadUserGroups();
    loadAvailablePermissions();
  }, []);
  
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    try {
      const response = await fetch('/api/admin/users/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          ...formData,
          additionalPermissions: selectedPermissions
        })
      });
      
      if (response.ok) {
        toast.success('ุชู ุฅูุดุงุก ุงููุณุชุฎุฏู ุจูุฌุงุญ');
        router.push('/admin/users');
      } else {
        const error = await response.json();
        toast.error(error.message || 'ุญุฏุซ ุฎุทุฃ ูู ุฅูุดุงุก ุงููุณุชุฎุฏู');
      }
    } catch (error) {
      toast.error('ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู');
    }
  };
  
  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {/* ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <Input
          label="ุงูุงุณู ุงููุงูู"
          value={formData.fullName}
          onChange={(e) => setFormData({...formData, fullName: e.target.value})}
          required
        />
        
        <Input
          label="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู"
          type="email"
          value={formData.email}
          onChange={(e) => setFormData({...formData, email: e.target.value})}
          required
        />
        
        <Input
          label="ุฑูู ุงููุงุชู"
          value={formData.phone}
          onChange={(e) => setFormData({...formData, phone: e.target.value})}
          required
        />
        
        <Select
          label="ูุฌููุนุฉ ุงููุณุชุฎุฏู"
          value={formData.groupId}
          onChange={(value) => setFormData({...formData, groupId: value})}
          required
        >
          {userGroups.map(group => (
            <option key={group.id} value={group.id}>
              {group.name}
            </option>
          ))}
        </Select>
      </div>
      
      {/* ุงูุตูุงุญูุงุช ุงูุฅุถุงููุฉ */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold">ุงูุตูุงุญูุงุช ุงูุฅุถุงููุฉ</h3>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {availablePermissions.map(permission => (
            <label key={permission.id} className="flex items-center space-x-2">
              <input
                type="checkbox"
                checked={selectedPermissions.includes(permission.id)}
                onChange={(e) => {
                  if (e.target.checked) {
                    setSelectedPermissions([...selectedPermissions, permission.id]);
                  } else {
                    setSelectedPermissions(
                      selectedPermissions.filter(id => id !== permission.id)
                    );
                  }
                }}
              />
              <span>{permission.name}</span>
            </label>
          ))}
        </div>
      </div>
      
      {/* ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช */}
      <div className="flex justify-end space-x-4">
        <Button type="button" variant="secondary" onClick={() => router.back()}>
          ุฅูุบุงุก
        </Button>
        <Button type="submit" variant="primary">
          ุฅูุดุงุก ุงููุณุชุฎุฏู
        </Button>
      </div>
    </form>
  );
}
```

---

## 7. ุงูุฃูุงู ูุงูุญูุงูุฉ
### Security and Protection

### ุญูุงูุฉ ูููุงุช ุงููุฑูุฑ
```typescript
// ุชุดููุฑ ูููุฉ ุงููุฑูุฑ
const hashPassword = async (password: string): Promise<string> => {
  const saltRounds = 12;
  return await bcrypt.hash(password, saltRounds);
};

// ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ
const verifyPassword = async (password: string, hash: string): Promise<boolean> => {
  return await bcrypt.compare(password, hash);
};

// ุฅูุดุงุก ูููุฉ ูุฑูุฑ ูููุฉ
const generateStrongPassword = (): string => {
  const length = 12;
  const charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*';
  let password = '';
  
  for (let i = 0; i < length; i++) {
    password += charset.charAt(Math.floor(Math.random() * charset.length));
  }
  
  return password;
};
```

### ุญูุงูุฉ ุงูุฌูุณุงุช
```typescript
// ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช
interface UserSession {
  id: string;
  userId: string;
  sessionToken: string;
  ipAddress: string;
  userAgent: string;
  expiresAt: Date;
  isActive: boolean;
}

// ุฅูุดุงุก ุฌูุณุฉ ุฌุฏูุฏุฉ
const createSession = async (userId: string, ipAddress: string, userAgent: string) => {
  const sessionToken = crypto.randomUUID();
  const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 ุณุงุนุฉ
  
  return await prisma.userSession.create({
    data: {
      userId,
      sessionToken,
      ipAddress,
      userAgent,
      expiresAt,
      isActive: true
    }
  });
};

// ุงูุชุญูู ูู ุตุญุฉ ุงูุฌูุณุฉ
const validateSession = async (sessionToken: string): Promise<User | null> => {
  const session = await prisma.userSession.findUnique({
    where: { sessionToken },
    include: { user: true }
  });
  
  if (!session || !session.isActive || session.expiresAt < new Date()) {
    return null;
  }
  
  // ุชุญุฏูุซ ุขุฎุฑ ูุดุงุท
  await prisma.userSession.update({
    where: { id: session.id },
    data: { lastActivity: new Date() }
  });
  
  return session.user;
};
```

### ุชุณุฌูู ูุญุงููุงุช ุชุณุฌูู ุงูุฏุฎูู
```typescript
// ุชุณุฌูู ูุญุงููุฉ ุชุณุฌูู ุงูุฏุฎูู
const logLoginAttempt = async (
  email: string,
  ipAddress: string,
  userAgent: string,
  isSuccessful: boolean,
  failureReason?: string
) => {
  await prisma.loginAttempt.create({
    data: {
      email,
      ipAddress,
      userAgent,
      isSuccessful,
      failureReason,
      attemptAt: new Date()
    }
  });
};

// ุงูุชุญูู ูู ูุญุงููุงุช ุชุณุฌูู ุงูุฏุฎูู ุงููุชูุฑุฑุฉ
const checkBruteForce = async (email: string, ipAddress: string): Promise<boolean> => {
  const lastHour = new Date(Date.now() - 60 * 60 * 1000);
  
  const failedAttempts = await prisma.loginAttempt.count({
    where: {
      OR: [
        { email },
        { ipAddress }
      ],
      isSuccessful: false,
      attemptAt: { gte: lastHour }
    }
  });
  
  return failedAttempts >= 5; // ุญุฏ ุฃูุตู 5 ูุญุงููุงุช ูุงุดูุฉ ูู ุงูุณุงุนุฉ
};
```

---

## 8. ุงูุชูุงุฑูุฑ ูุงููุฑุงูุจุฉ
### Reports and Monitoring

### ุชูุฑูุฑ ูุดุงุท ุงููุณุชุฎุฏููู
```typescript
// ุชูุฑูุฑ ุชุณุฌูู ุงูุฏุฎูู
const getUserLoginReport = async (startDate: Date, endDate: Date) => {
  return await prisma.loginAttempt.groupBy({
    by: ['email', 'isSuccessful'],
    where: {
      attemptAt: {
        gte: startDate,
        lte: endDate
      }
    },
    _count: {
      id: true
    }
  });
};

// ุชูุฑูุฑ ุงููุณุชุฎุฏููู ุงููุดุทูู
const getActiveUsersReport = async () => {
  const lastMonth = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
  
  return await prisma.userSession.groupBy({
    by: ['userId'],
    where: {
      lastActivity: { gte: lastMonth },
      isActive: true
    },
    _count: {
      id: true
    },
    _max: {
      lastActivity: true
    }
  });
};

// ุชูุฑูุฑ ุงุณุชุฎุฏุงู ุงูุตูุงุญูุงุช
const getPermissionUsageReport = async () => {
  return await prisma.auditLog.groupBy({
    by: ['action', 'tableName'],
    where: {
      timestamp: {
        gte: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000) // ุขุฎุฑ ุฃุณุจูุน
      }
    },
    _count: {
      id: true
    }
  });
};
```

---

## 9. ุงูุตูุงูุฉ ูุงูุชุญุฏูุซ
### Maintenance and Updates

### ุชูุธูู ุงูุฌูุณุงุช ุงูููุชููุฉ ุงูุตูุงุญูุฉ
```typescript
// ูููุฉ ุฏูุฑูุฉ ูุชูุธูู ุงูุฌูุณุงุช
const cleanupExpiredSessions = async () => {
  const now = new Date();
  
  const deletedSessions = await prisma.userSession.deleteMany({
    where: {
      OR: [
        { expiresAt: { lt: now } },
        { 
          lastActivity: { 
            lt: new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000) // ุฃุณุจูุน ูู ุนุฏู ุงููุดุงุท
          }
        }
      ]
    }
  });
  
  console.log(`ุชู ุญุฐู ${deletedSessions.count} ุฌูุณุฉ ููุชููุฉ ุงูุตูุงุญูุฉ`);
};

// ุชุดุบูู ุงููููุฉ ูู ุณุงุนุฉ
setInterval(cleanupExpiredSessions, 60 * 60 * 1000);
```

### ุชุญุฏูุซ ูููุงุช ุงููุฑูุฑ ุงูููุชููุฉ ุงูุตูุงุญูุฉ
```typescript
// ุฅุฌุจุงุฑ ุชุบููุฑ ูููุงุช ุงููุฑูุฑ ุงููุฏููุฉ
const forcePasswordUpdate = async () => {
  const threeMonthsAgo = new Date(Date.now() - 90 * 24 * 60 * 60 * 1000);
  
  await prisma.user.updateMany({
    where: {
      lastPasswordChange: { lt: threeMonthsAgo },
      mustChangePassword: false
    },
    data: {
      mustChangePassword: true
    }
  });
};
```

---

## 10. ุฃูุถู ุงูููุงุฑุณุงุช
### Best Practices

### ๐ ุงูุฃูุงู
1. **ูููุงุช ุงููุฑูุฑ ุงููููุฉ**: ุงุณุชุฎุฏู ูููุงุช ูุฑูุฑ ูุนูุฏุฉ ูุฅุฌุจุงุฑ ุชุบููุฑูุง ุฏูุฑูุงู
2. **ุงูุชุดููุฑ**: ุฌููุน ูููุงุช ุงููุฑูุฑ ูุดูุฑุฉ ุจุงุณุชุฎุฏุงู bcrypt
3. **ุงูุฌูุณุงุช ุงูุขููุฉ**: ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฌูุณุงุช ูุชุชุจุน ุงููุดุงุท
4. **ูุฑุงูุจุฉ ูุญุงููุงุช ุงูุงุฎุชุฑุงู**: ุชุณุฌูู ููุฑุงูุจุฉ ูุญุงููุงุช ุชุณุฌูู ุงูุฏุฎูู ุงููุงุดูุฉ

### ๐ฅ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
1. **ูุจุฏุฃ ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุตูุงุญูุงุช**: ุฅุนุทุงุก ุฃูู ุตูุงุญูุงุช ููููุฉ
2. **ุงููุฑุงุฌุนุฉ ุงูุฏูุฑูุฉ**: ูุฑุงุฌุนุฉ ุตูุงุญูุงุช ุงููุณุชุฎุฏููู ุจุงูุชุธุงู
3. **ุงูุชูุซูู**: ุชูุซูู ุฌููุน ุงูุชุบููุฑุงุช ูู ุงูุตูุงุญูุงุช
4. **ุงูุชุฏุฑูุจ**: ุชุฏุฑูุจ ุงููุณุชุฎุฏููู ุนูู ุงุณุชุฎุฏุงู ุงููุธุงู ุจุฃูุงู

### ๐ ุงููุฑุงูุจุฉ ูุงูุชุฏููู
1. **ุณุฌูุงุช ุงูุชุฏููู**: ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงููููุฉ
2. **ุงูุชูุงุฑูุฑ ุงูุฏูุฑูุฉ**: ุฅูุดุงุก ุชูุงุฑูุฑ ุฏูุฑูุฉ ุนู ูุดุงุท ุงููุณุชุฎุฏููู
3. **ุงูุชูุจููุงุช**: ุฅุนุฏุงุฏ ุชูุจููุงุช ููุฃูุดุทุฉ ุงููุดุจููุฉ
4. **ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ**: ูุณุฎ ุงุญุชูุงุทูุฉ ููุชุธูุฉ ูุจูุงูุงุช ุงููุณุชุฎุฏููู

---

## ุงูุฎูุงุตุฉ
### Summary

ูููุฑ ูุธุงู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช ูู ุชุทุจูู ุฅุฏุงุฑุฉ ุงูููุงุฏู:

โ **ูุธุงู ุตูุงุญูุงุช ูุชูุฏู** ูุน ูุฌููุนุงุช ูุณุชุฎุฏููู ูุตูุงุญูุงุช ูุฎุตุตุฉ
โ **ุฃูุงู ุนุงูู** ูุน ุชุดููุฑ ูููุงุช ุงููุฑูุฑ ููุฑุงูุจุฉ ุงูุฌูุณุงุช
โ **ูุฑููุฉ ูู ุงูุฅุฏุงุฑุฉ** ูุน ุฅููุงููุฉ ุชุฎุตูุต ุงูุตูุงุญูุงุช ููู ูุณุชุฎุฏู
โ **ูุฑุงูุจุฉ ุดุงููุฉ** ูุน ุณุฌูุงุช ุงูุชุฏููู ูุงูุชูุงุฑูุฑ
โ **ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู** ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช

ูุฐุง ุงููุธุงู ูุถูู ุงูุฃูุงู ูุงููุฑููุฉ ูู ุฅุฏุงุฑุฉ ุงููุตูู ูุฌููุน ูุธุงุฆู ุงููุธุงู ุญุณุจ ุฏูุฑ ูู ูุณุชุฎุฏู.